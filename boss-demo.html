<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Boss Attack Controller - Demo</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #0a0a0a;
      color: #e0e0e0;
      overflow-x: hidden;
    }
    
    .demo-container {
      width: 100%;
      min-height: 100vh;
    }
    
    #game-canvas {
      width: 100%;
      height: 70vh;
      min-height: 500px;
      background: #000000;
      position: relative;
      cursor: crosshair;
    }
    
    #game-canvas canvas {
      display: block;
    }
    
    /* Boss HP Bar */
    #boss-hp-container {
      position: absolute;
      top: 30px;
      left: 50%;
      transform: translateX(-50%);
      width: 60%;
      max-width: 600px;
      font-family: 'Courier New', monospace;
      pointer-events: none;
    }
    
    #boss-name {
      text-align: center;
      font-size: 24px;
      font-weight: bold;
      color: #ff4444;
      text-shadow: 0 0 20px #ff0000;
      margin-bottom: 8px;
      letter-spacing: 4px;
    }
    
    #hp-bar-outer {
      background: rgba(0, 0, 0, 0.7);
      border: 2px solid #ff4444;
      border-radius: 4px;
      padding: 4px;
      box-shadow: 0 0 10px rgba(255, 68, 68, 0.5);
    }
    
    #hp-bar-inner {
      height: 20px;
      background: linear-gradient(90deg, #ff2222 0%, #ff6666 100%);
      width: 100%;
      transition: width 0.3s ease-out;
      border-radius: 2px;
      box-shadow: inset 0 2px 4px rgba(255, 255, 255, 0.3);
    }
    
    #hp-text {
      display: flex;
      justify-content: space-between;
      margin-top: 4px;
      font-size: 12px;
      color: #ffffff;
    }
    
    /* Attack Status */
    #attack-status {
      text-align: center;
      margin-top: 15px;
      padding: 12px 20px;
      background: rgba(255, 136, 0, 0.2);
      border: 1px solid #ff8800;
      border-radius: 4px;
      display: none;
    }
    
    #attack-status.visible {
      display: block;
    }
    
    #attack-status.telegraph {
      background: rgba(255, 136, 0, 0.3);
      border-color: #ff8800;
      animation: pulse 0.5s infinite;
    }
    
    #attack-status.executing {
      background: rgba(255, 0, 0, 0.3);
      border-color: #ff0000;
    }
    
    #attack-status.recovery {
      background: rgba(0, 255, 136, 0.2);
      border-color: #00ff88;
    }
    
    #attack-phase {
      font-size: 14px;
      font-weight: bold;
    }
    
    #attack-name {
      font-size: 18px;
      margin-top: 4px;
    }
    
    #evasion-hint {
      font-size: 11px;
      margin-top: 4px;
      color: #88ff88;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
    
    /* Evasion Prompt */
    #evasion-prompt {
      position: absolute;
      bottom: 120px;
      left: 50%;
      transform: translateX(-50%);
      text-align: center;
      font-family: 'Courier New', monospace;
      pointer-events: none;
      display: none;
    }
    
    #evasion-prompt.visible {
      display: block;
    }
    
    #evasion-direction {
      font-size: 48px;
      color: #ffaa00;
      text-shadow: 0 0 20px #ffaa00;
    }
    
    #evasion-direction.optimal {
      color: #00ff00;
      text-shadow: 0 0 30px #00ff00;
      animation: bounce 0.3s infinite;
    }
    
    @keyframes bounce {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.2); }
    }
    
    #timing-bar {
      width: 200px;
      height: 10px;
      background: rgba(0, 0, 0, 0.5);
      border: 2px solid #888;
      border-radius: 5px;
      margin: 10px auto;
      position: relative;
      overflow: hidden;
    }
    
    #timing-zone {
      position: absolute;
      background: rgba(0, 255, 0, 0.3);
      height: 100%;
    }
    
    #timing-indicator {
      position: absolute;
      top: -2px;
      width: 4px;
      height: 14px;
      background: #ffffff;
      border-radius: 2px;
    }
    
    #dodge-text {
      font-size: 20px;
      color: #00ff00;
      font-weight: bold;
      text-shadow: 0 0 15px #00ff00;
      display: none;
    }
    
    #dodge-text.visible {
      display: block;
    }
    
    /* Controls Panel */
    #controls-panel {
      position: absolute;
      left: 20px;
      bottom: 20px;
      font-family: 'Courier New', monospace;
      font-size: 11px;
      color: #00ff88;
      opacity: 0.8;
    }
    
    #controls-panel div {
      margin: 3px 0;
    }
    
    /* Attack Select Panel */
    #attack-panel {
      position: absolute;
      right: 20px;
      top: 200px;
      background: rgba(0, 0, 0, 0.8);
      border: 1px solid #444;
      border-radius: 8px;
      padding: 15px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      max-width: 250px;
    }
    
    #attack-panel h3 {
      color: #ff4444;
      margin-bottom: 10px;
      border-bottom: 1px solid #444;
      padding-bottom: 5px;
    }
    
    .attack-btn {
      display: block;
      width: 100%;
      padding: 8px 12px;
      margin: 5px 0;
      background: rgba(255, 68, 68, 0.2);
      border: 1px solid #ff4444;
      color: #ff8888;
      border-radius: 4px;
      cursor: pointer;
      text-align: left;
      font-family: inherit;
      font-size: 11px;
      transition: all 0.2s;
    }
    
    .attack-btn:hover {
      background: rgba(255, 68, 68, 0.4);
      border-color: #ff6666;
      color: #ffffff;
    }
    
    .attack-btn.common {
      border-color: #4488ff;
      background: rgba(68, 136, 255, 0.2);
      color: #88aaff;
    }
    
    .attack-btn.common:hover {
      background: rgba(68, 136, 255, 0.4);
    }
    
    .attack-type {
      font-size: 9px;
      color: #888;
      margin-top: 2px;
    }
    
    /* Level Select */
    #level-select {
      position: absolute;
      right: 20px;
      top: 50px;
      background: rgba(0, 0, 0, 0.8);
      border: 1px solid #444;
      border-radius: 8px;
      padding: 15px;
      font-family: 'Courier New', monospace;
    }
    
    #level-select label {
      color: #888;
      font-size: 12px;
    }
    
    #level-select select {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      background: #1a1a2a;
      border: 1px solid #444;
      color: #ffffff;
      border-radius: 4px;
      font-family: inherit;
    }
    
    /* Info Panel */
    .info-panel {
      padding: 30px;
      background: linear-gradient(180deg, #0d0d15 0%, #0a0a0a 100%);
      border-top: 1px solid #1a1a2a;
    }
    
    .info-panel h1 {
      font-size: 2em;
      color: #ff4444;
      text-shadow: 0 0 20px rgba(255, 68, 68, 0.5);
      margin-bottom: 10px;
    }
    
    .info-panel h2 {
      font-size: 1.3em;
      color: #4488ff;
      margin: 25px 0 15px 0;
      border-bottom: 1px solid #2a2a4a;
      padding-bottom: 8px;
    }
    
    .subtitle {
      color: #888;
      font-size: 1.1em;
      margin-bottom: 25px;
    }
    
    .features-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }
    
    .feature-card {
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid #2a2a3a;
      border-radius: 8px;
      padding: 20px;
      transition: all 0.3s ease;
    }
    
    .feature-card:hover {
      border-color: #ff4444;
      box-shadow: 0 0 20px rgba(255, 68, 68, 0.1);
    }
    
    .feature-card h3 {
      color: #ff4444;
      margin-bottom: 10px;
    }
    
    .feature-card p {
      color: #aaa;
      line-height: 1.6;
    }
    
    /* Attack Table */
    .attack-table {
      width: 100%;
      border-collapse: collapse;
      margin: 15px 0;
    }
    
    .attack-table th,
    .attack-table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #2a2a3a;
    }
    
    .attack-table th {
      color: #ff4444;
      font-weight: 600;
      background: rgba(255, 68, 68, 0.1);
    }
    
    .attack-table td:first-child {
      color: #ffaa44;
      font-family: 'Courier New', monospace;
    }
    
    .attack-table tr:hover {
      background: rgba(255, 255, 255, 0.02);
    }
    
    .badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 10px;
      font-weight: bold;
    }
    
    .badge.common {
      background: rgba(68, 136, 255, 0.3);
      color: #88aaff;
    }
    
    .badge.unique {
      background: rgba(255, 68, 68, 0.3);
      color: #ff8888;
    }
    
    .config-section {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
    }
    
    .config-section pre {
      background: #0d0d1a;
      border: 1px solid #2a2a4a;
      border-radius: 4px;
      padding: 15px;
      overflow-x: auto;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
      line-height: 1.5;
      color: #ff8888;
    }
    
    footer {
      text-align: center;
      padding: 30px;
      color: #666;
      border-top: 1px solid #1a1a2a;
    }
  </style>
</head>
<body>
  <div class="demo-container">
    <!-- Game Canvas -->
    <div id="game-canvas">
      <!-- Boss HP Bar -->
      <div id="boss-hp-container">
        <div id="boss-name">CORNERIA MECH</div>
        <div id="hp-bar-outer">
          <div id="hp-bar-inner"></div>
        </div>
        <div id="hp-text">
          <span id="hp-current">1000 / 1000</span>
          <span id="hp-percent">100.0%</span>
        </div>
        
        <div id="attack-status">
          <div id="attack-phase">‚ö† WARNING</div>
          <div id="attack-name">Loading...</div>
          <div id="evasion-hint">EVADE: UP</div>
        </div>
      </div>
      
      <!-- Evasion Prompt -->
      <div id="evasion-prompt">
        <div id="evasion-direction">‚¨Ü</div>
        <div id="timing-bar">
          <div id="timing-zone"></div>
          <div id="timing-indicator"></div>
        </div>
        <div id="dodge-text">DODGE NOW!</div>
      </div>
      
      <!-- Controls -->
      <div id="controls-panel">
        <div>CLICK - Fire at weak points</div>
        <div>WASD - Move ship (simulated)</div>
        <div>SPACE - Barrel Roll / Dodge</div>
        <div>1-9 - Trigger specific attack</div>
      </div>
      
      <!-- Level Select -->
      <div id="level-select">
        <label>Select Boss Level:</label>
        <select id="boss-level">
          <option value="1">Level 1 - Corneria Mech</option>
          <option value="2">Level 2 - Asteroid Carrier</option>
          <option value="3">Level 3 - Ice Walker</option>
          <option value="4">Level 4 - Magma Serpent</option>
          <option value="5">Level 5 - Bio-Weapon</option>
          <option value="6">Level 6 - Mech-Virus</option>
          <option value="7">Level 7 - Andross</option>
        </select>
      </div>
      
      <!-- Attack Panel -->
      <div id="attack-panel">
        <h3>Trigger Attack</h3>
        <div id="attack-buttons"></div>
      </div>
    </div>
    
    <!-- Info Panel -->
    <div class="info-panel">
      <h1>üéÆ Boss Attack Controller</h1>
      <p class="subtitle">QTE-style boss battle system for Starfox 64 inspired games</p>
      
      <h2>Features</h2>
      <div class="features-grid">
        <div class="feature-card">
          <h3>‚ö° Attack State Machine</h3>
          <p>Four-phase attack cycle: Idle ‚Üí Telegraph ‚Üí Execute ‚Üí Recovery. Each phase has distinct visual and audio cues to create tension and allow player reaction.</p>
        </div>
        
        <div class="feature-card">
          <h3>üéØ Telegraphed Attacks</h3>
          <p>All attacks feature warning indicators before execution, giving players time to identify the attack type and prepare the correct evasion maneuver.</p>
        </div>
        
        <div class="feature-card">
          <h3>üî¥ Danger Zones</h3>
          <p>Visual danger zone overlays pulse during telegraph and intensify during execution. Different shapes for different attack patterns.</p>
        </div>
        
        <div class="feature-card">
          <h3>üíé Weak Points</h3>
          <p>Boss weak points become vulnerable during recovery phase after attacks, creating a risk/reward loop for aggressive play.</p>
        </div>
        
        <div class="feature-card">
          <h3>‚è±Ô∏è Evasion Timing</h3>
          <p>QTE-style timing window for perfect dodges. Visual timing bar shows optimal evasion window during telegraph phase.</p>
        </div>
        
        <div class="feature-card">
          <h3>üìà Dynamic Difficulty</h3>
          <p>Attack frequency increases as boss health decreases. Unique attacks become more likely at low health for dramatic finales.</p>
        </div>
      </div>
      
      <h2>Attack Types</h2>
      <table class="attack-table">
        <thead>
          <tr>
            <th>Attack</th>
            <th>Type</th>
            <th>Level</th>
            <th>Damage</th>
            <th>Evasion</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Sweeping Laser</td>
            <td><span class="badge common">COMMON</span></td>
            <td>All</td>
            <td>25</td>
            <td>Vertical</td>
          </tr>
          <tr>
            <td>Missile Barrage</td>
            <td><span class="badge common">COMMON</span></td>
            <td>All</td>
            <td>15</td>
            <td>Barrel Roll</td>
          </tr>
          <tr>
            <td>Seismic Stomp</td>
            <td><span class="badge unique">UNIQUE</span></td>
            <td>1</td>
            <td>40</td>
            <td>Up</td>
          </tr>
          <tr>
            <td>Debris Storm</td>
            <td><span class="badge unique">UNIQUE</span></td>
            <td>2</td>
            <td>20</td>
            <td>Weave</td>
          </tr>
          <tr>
            <td>Cryo Blast</td>
            <td><span class="badge unique">UNIQUE</span></td>
            <td>3</td>
            <td>35</td>
            <td>Horizontal</td>
          </tr>
          <tr>
            <td>Solar Flare</td>
            <td><span class="badge unique">UNIQUE</span></td>
            <td>4</td>
            <td>50</td>
            <td>Barrel Roll</td>
          </tr>
          <tr>
            <td>Toxic Spray</td>
            <td><span class="badge unique">UNIQUE</span></td>
            <td>5</td>
            <td>30</td>
            <td>Retreat</td>
          </tr>
          <tr>
            <td>System Corruption</td>
            <td><span class="badge unique">UNIQUE</span></td>
            <td>6</td>
            <td>45</td>
            <td>Random</td>
          </tr>
          <tr>
            <td>Andross's Wrath</td>
            <td><span class="badge unique">UNIQUE</span></td>
            <td>7</td>
            <td>60</td>
            <td>Complex</td>
          </tr>
        </tbody>
      </table>
      
      <h2>Configuration</h2>
      <div class="config-section">
        <pre>
const BOSS_CONFIG = {
  BASE_HP: 1000,
  DAMAGE_FLASH_DURATION: 150,
  INVULNERABLE_AFTER_HIT: 200,
  
  ATTACK_INTERVAL_MIN: 3000,
  ATTACK_INTERVAL_MAX: 6000,
  TELEGRAPH_DURATION: 1500,
  ATTACK_DURATION: 2000,
  RECOVERY_DURATION: 1000,
  
  DANGER_ZONE_OPACITY: 0.4,
  DANGER_ZONE_PULSE_SPEED: 8,
  
  BOSS_SIZE: 5,
  WEAK_POINT_SIZE: 1,
  
  EVASION_WINDOW_START: 0.7,
  EVASION_WINDOW_END: 0.95,
};
        </pre>
      </div>
      
      <h2>Integration Example</h2>
      <div class="config-section">
        <pre>
import { 
  BossFightScene,
  useBossAttackController,
  BOSS_CONFIG 
} from './BossAttackController';

function BossBattle() {
  const handleBossDefeated = () => {
    console.log('Victory!');
    // Transition to results screen
  };

  const handlePlayerHit = (damage) => {
    playerHealth -= damage;
    // Play damage sound, screen shake, etc.
  };

  return (
    &lt;Canvas&gt;
      &lt;BossFightScene
        bossLevel={currentLevel}
        bossName="CORNERIA MECH"
        maxHP={1000}
        onBossDefeated={handleBossDefeated}
        onPlayerHit={handlePlayerHit}
        playerIsInvulnerable={isBarrelRolling}
      /&gt;
    &lt;/Canvas&gt;
  );
}
        </pre>
      </div>
    </div>
    
    <footer>
      <p>Boss Attack Controller - Starfox 64 Inspired Game Component</p>
    </footer>
  </div>

  <!-- Three.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  
  <script>
    // ========================================================================
    // CONFIGURATION
    // ========================================================================
    const BOSS_CONFIG = {
      BASE_HP: 1000,
      DAMAGE_FLASH_DURATION: 150,
      ATTACK_INTERVAL_MIN: 3000,
      ATTACK_INTERVAL_MAX: 6000,
      TELEGRAPH_DURATION: 1500,
      ATTACK_DURATION: 2000,
      RECOVERY_DURATION: 1000,
      DANGER_ZONE_PULSE_SPEED: 8,
      BOSS_SIZE: 5,
      WEAK_POINT_SIZE: 1,
      EVASION_WINDOW_START: 0.7,
      EVASION_WINDOW_END: 0.95,
    };
    
    const ATTACK_PHASE = {
      IDLE: 'idle',
      TELEGRAPH: 'telegraph',
      EXECUTING: 'executing',
      RECOVERY: 'recovery',
    };
    
    // Attack Definitions
    const COMMON_ATTACKS = {
      SWEEPING_LASER: {
        id: 'sweeping_laser',
        name: 'Sweeping Laser',
        type: 'common',
        damage: 25,
        telegraphDuration: 1200,
        executeDuration: 1800,
        recoveryDuration: 800,
        dangerZone: 'horizontal_sweep',
        indicator: 'laser_charge',
        evasionDirection: 'vertical',
      },
      MISSILE_BARRAGE: {
        id: 'missile_barrage',
        name: 'Missile Barrage',
        type: 'common',
        damage: 15,
        telegraphDuration: 1500,
        executeDuration: 2500,
        recoveryDuration: 1000,
        dangerZone: 'tracking_missiles',
        indicator: 'lock_on',
        evasionDirection: 'barrel_roll',
      },
    };
    
    const UNIQUE_ATTACKS = {
      1: {
        id: 'stomp_shockwave',
        name: 'Seismic Stomp',
        type: 'unique',
        bossLevel: 1,
        damage: 40,
        telegraphDuration: 1800,
        executeDuration: 1200,
        recoveryDuration: 1500,
        dangerZone: 'ground_ring',
        indicator: 'leg_raise',
        evasionDirection: 'up',
      },
      2: {
        id: 'debris_storm',
        name: 'Debris Storm',
        type: 'unique',
        bossLevel: 2,
        damage: 20,
        telegraphDuration: 2000,
        executeDuration: 3000,
        recoveryDuration: 800,
        dangerZone: 'scattered_zones',
        indicator: 'asteroid_gather',
        evasionDirection: 'weave',
      },
      3: {
        id: 'cryo_blast',
        name: 'Cryo Blast',
        type: 'unique',
        bossLevel: 3,
        damage: 35,
        telegraphDuration: 1400,
        executeDuration: 1600,
        recoveryDuration: 1200,
        dangerZone: 'cone_forward',
        indicator: 'frost_buildup',
        evasionDirection: 'horizontal',
      },
      4: {
        id: 'solar_flare',
        name: 'Solar Flare',
        type: 'unique',
        bossLevel: 4,
        damage: 50,
        telegraphDuration: 2200,
        executeDuration: 1000,
        recoveryDuration: 2000,
        dangerZone: 'full_arena_flash',
        indicator: 'heat_buildup',
        evasionDirection: 'barrel_roll',
      },
      5: {
        id: 'toxic_spray',
        name: 'Toxic Spray',
        type: 'unique',
        bossLevel: 5,
        damage: 30,
        telegraphDuration: 1600,
        executeDuration: 2200,
        recoveryDuration: 900,
        dangerZone: 'spreading_cloud',
        indicator: 'gas_buildup',
        evasionDirection: 'retreat',
      },
      6: {
        id: 'system_corruption',
        name: 'System Corruption',
        type: 'unique',
        bossLevel: 6,
        damage: 45,
        telegraphDuration: 1000,
        executeDuration: 2800,
        recoveryDuration: 1100,
        dangerZone: 'glitch_zones',
        indicator: 'static_interference',
        evasionDirection: 'random',
      },
      7: {
        id: 'andross_wrath',
        name: "Andross's Wrath",
        type: 'unique',
        bossLevel: 7,
        damage: 60,
        telegraphDuration: 2500,
        executeDuration: 3500,
        recoveryDuration: 1500,
        dangerZone: 'multi_phase',
        indicator: 'power_surge',
        evasionDirection: 'complex',
      },
    };
    
    const BOSS_NAMES = {
      1: 'CORNERIA MECH',
      2: 'ASTEROID CARRIER',
      3: 'ICE WALKER',
      4: 'MAGMA SERPENT',
      5: 'BIO-WEAPON X',
      6: 'MECH-VIRUS',
      7: 'ANDROSS',
    };
    
    // ========================================================================
    // BOSS FIGHT GAME CLASS
    // ========================================================================
    class BossFightGame {
      constructor(container) {
        this.container = container;
        this.currentLevel = 1;
        this.bossHP = BOSS_CONFIG.BASE_HP;
        this.maxHP = BOSS_CONFIG.BASE_HP;
        this.phase = ATTACK_PHASE.IDLE;
        this.currentAttack = null;
        this.attackProgress = 0;
        this.attackStartTime = 0;
        this.phaseDuration = 0;
        this.isHit = false;
        
        this.init();
        this.setupAttackButtons();
        this.setupLevelSelect();
        this.scheduleNextAttack();
        this.animate();
      }
      
      init() {
        // Scene
        this.scene = new THREE.Scene();
        this.scene.fog = new THREE.Fog(0x000000, 30, 80);
        
        // Camera
        this.camera = new THREE.PerspectiveCamera(
          75,
          this.container.clientWidth / this.container.clientHeight,
          0.1,
          1000
        );
        this.camera.position.set(0, 2, 15);
        this.camera.lookAt(0, 0, -10);
        
        // Renderer
        this.renderer = new THREE.WebGLRenderer({ antialias: true });
        this.renderer.setSize(this.container.clientWidth, this.container.clientHeight);
        this.renderer.setClearColor(0x000000);
        this.container.appendChild(this.renderer.domElement);
        
        // Lighting
        this.ambientLight = new THREE.AmbientLight(0x222244, 0.3);
        this.scene.add(this.ambientLight);
        
        this.bossLight = new THREE.PointLight(0xff4444, 1, 30);
        this.bossLight.position.set(0, 0, -20);
        this.scene.add(this.bossLight);
        
        // Create boss
        this.createBoss();
        
        // Create danger zone placeholder
        this.createDangerZone();
        
        // Create weak point
        this.createWeakPoint();
        
        // Create attack indicator
        this.createAttackIndicator();
        
        // Event listeners
        window.addEventListener('resize', () => this.onResize());
        window.addEventListener('keydown', (e) => this.onKeyDown(e));
        this.container.addEventListener('click', (e) => this.onClick(e));
        
        // Raycaster for click detection
        this.raycaster = new THREE.Raycaster();
        this.mouse = new THREE.Vector2();
        
        this.lastTime = performance.now();
      }
      
      createBoss() {
        this.bossGroup = new THREE.Group();
        this.bossGroup.position.set(0, 0, -20);
        
        // Main body
        const bodyGeom = new THREE.BoxGeometry(
          BOSS_CONFIG.BOSS_SIZE,
          BOSS_CONFIG.BOSS_SIZE,
          BOSS_CONFIG.BOSS_SIZE
        );
        this.bodyMaterial = new THREE.MeshStandardMaterial({
          color: 0x8844ff,
          emissive: 0x221144,
          metalness: 0.7,
          roughness: 0.3,
        });
        this.bossBody = new THREE.Mesh(bodyGeom, this.bodyMaterial);
        this.bossGroup.add(this.bossBody);
        
        // Core glow
        const coreGeom = new THREE.SphereGeometry(BOSS_CONFIG.BOSS_SIZE * 0.4, 16, 16);
        this.coreMaterial = new THREE.MeshBasicMaterial({
          color: 0xff44ff,
          transparent: true,
          opacity: 0.6,
        });
        this.bossCore = new THREE.Mesh(coreGeom, this.coreMaterial);
        this.bossGroup.add(this.bossCore);
        
        // Side arms
        const armGeom = new THREE.BoxGeometry(1, 3, 1);
        const armMat = new THREE.MeshStandardMaterial({ color: 0x444488, metalness: 0.8 });
        const leftArm = new THREE.Mesh(armGeom, armMat);
        leftArm.position.x = BOSS_CONFIG.BOSS_SIZE * 0.6;
        this.bossGroup.add(leftArm);
        
        const rightArm = new THREE.Mesh(armGeom, armMat);
        rightArm.position.x = -BOSS_CONFIG.BOSS_SIZE * 0.6;
        this.bossGroup.add(rightArm);
        
        // Eye
        const eyeGeom = new THREE.SphereGeometry(1, 16, 16);
        this.eyeMaterial = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
        this.bossEye = new THREE.Mesh(eyeGeom, this.eyeMaterial);
        this.bossEye.position.z = BOSS_CONFIG.BOSS_SIZE * 0.5 + 0.1;
        this.bossGroup.add(this.bossEye);
        
        this.eyeLight = new THREE.PointLight(0x00ff00, 2, 10);
        this.bossEye.add(this.eyeLight);
        
        this.scene.add(this.bossGroup);
      }
      
      createDangerZone() {
        this.dangerZoneGroup = new THREE.Group();
        this.dangerZoneGroup.visible = false;
        
        // Horizontal sweep zone
        const sweepGeom = new THREE.PlaneGeometry(30, 4);
        this.dangerZoneMaterial = new THREE.MeshBasicMaterial({
          color: 0xff0000,
          transparent: true,
          opacity: 0,
          side: THREE.DoubleSide,
        });
        this.dangerZoneMesh = new THREE.Mesh(sweepGeom, this.dangerZoneMaterial);
        this.dangerZoneMesh.rotation.x = Math.PI / 2;
        this.dangerZoneGroup.add(this.dangerZoneMesh);
        
        this.dangerZoneGroup.position.set(0, 0, -10);
        this.scene.add(this.dangerZoneGroup);
      }
      
      createWeakPoint() {
        this.weakPointGroup = new THREE.Group();
        this.weakPointGroup.position.set(0, 2, -18);
        
        const wpGeom = new THREE.OctahedronGeometry(BOSS_CONFIG.WEAK_POINT_SIZE, 0);
        this.weakPointMaterial = new THREE.MeshStandardMaterial({
          color: 0x880000,
          emissive: 0x220000,
          emissiveIntensity: 0.2,
        });
        this.weakPointMesh = new THREE.Mesh(wpGeom, this.weakPointMaterial);
        this.weakPointGroup.add(this.weakPointMesh);
        
        this.weakPointLight = new THREE.PointLight(0xff0000, 0, 5);
        this.weakPointGroup.add(this.weakPointLight);
        
        this.scene.add(this.weakPointGroup);
      }
      
      createAttackIndicator() {
        this.indicatorGroup = new THREE.Group();
        this.indicatorGroup.position.copy(this.bossGroup.position);
        this.indicatorGroup.position.z += 2;
        this.indicatorGroup.visible = false;
        
        const indicatorGeom = new THREE.SphereGeometry(0.5, 16, 16);
        this.indicatorMaterial = new THREE.MeshBasicMaterial({ color: 0xff4444 });
        this.indicatorMesh = new THREE.Mesh(indicatorGeom, this.indicatorMaterial);
        this.indicatorGroup.add(this.indicatorMesh);
        
        this.indicatorLight = new THREE.PointLight(0xff0000, 0, 10);
        this.indicatorGroup.add(this.indicatorLight);
        
        this.scene.add(this.indicatorGroup);
      }
      
      setupAttackButtons() {
        const container = document.getElementById('attack-buttons');
        container.innerHTML = '';
        
        // Common attacks
        Object.values(COMMON_ATTACKS).forEach(attack => {
          const btn = document.createElement('button');
          btn.className = 'attack-btn common';
          btn.innerHTML = `${attack.name}<div class="attack-type">Common - ${attack.damage} DMG</div>`;
          btn.onclick = () => this.forceAttack(attack);
          container.appendChild(btn);
        });
        
        // Level-specific unique attack
        const uniqueAttack = UNIQUE_ATTACKS[this.currentLevel];
        if (uniqueAttack) {
          const btn = document.createElement('button');
          btn.className = 'attack-btn';
          btn.innerHTML = `${uniqueAttack.name}<div class="attack-type">Unique - ${uniqueAttack.damage} DMG</div>`;
          btn.onclick = () => this.forceAttack(uniqueAttack);
          container.appendChild(btn);
        }
      }
      
      setupLevelSelect() {
        const select = document.getElementById('boss-level');
        select.onchange = (e) => {
          this.currentLevel = parseInt(e.target.value);
          this.resetBoss();
          this.setupAttackButtons();
        };
      }
      
      resetBoss() {
        this.bossHP = BOSS_CONFIG.BASE_HP;
        this.phase = ATTACK_PHASE.IDLE;
        this.currentAttack = null;
        this.attackProgress = 0;
        
        document.getElementById('boss-name').textContent = BOSS_NAMES[this.currentLevel];
        
        this.clearAllTimers();
        this.scheduleNextAttack();
        this.updateHUD();
      }
      
      clearAllTimers() {
        if (this.attackTimer) clearTimeout(this.attackTimer);
        if (this.phaseTimer) clearTimeout(this.phaseTimer);
      }
      
      getAttacksForLevel() {
        const common = Object.values(COMMON_ATTACKS);
        const unique = UNIQUE_ATTACKS[this.currentLevel];
        return unique ? [...common, unique] : common;
      }
      
      scheduleNextAttack() {
        if (this.bossHP <= 0) return;
        
        const healthPercent = this.bossHP / this.maxHP;
        const rageMultiplier = 1 - (healthPercent * 0.3);
        const minDelay = BOSS_CONFIG.ATTACK_INTERVAL_MIN * rageMultiplier;
        const maxDelay = BOSS_CONFIG.ATTACK_INTERVAL_MAX * rageMultiplier;
        const delay = minDelay + Math.random() * (maxDelay - minDelay);
        
        this.attackTimer = setTimeout(() => {
          const attacks = this.getAttacksForLevel();
          const attack = attacks[Math.floor(Math.random() * attacks.length)];
          this.startAttack(attack);
        }, delay);
      }
      
      forceAttack(attack) {
        this.clearAllTimers();
        this.startAttack(attack);
      }
      
      startAttack(attack) {
        this.currentAttack = attack;
        this.phase = ATTACK_PHASE.TELEGRAPH;
        this.attackStartTime = performance.now();
        this.phaseDuration = attack.telegraphDuration;
        
        // Telegraph -> Execute
        this.phaseTimer = setTimeout(() => {
          this.phase = ATTACK_PHASE.EXECUTING;
          this.attackStartTime = performance.now();
          this.phaseDuration = attack.executeDuration;
          
          // Execute -> Recovery
          this.phaseTimer = setTimeout(() => {
            this.phase = ATTACK_PHASE.RECOVERY;
            this.attackStartTime = performance.now();
            this.phaseDuration = attack.recoveryDuration;
            
            // Recovery -> Idle
            this.phaseTimer = setTimeout(() => {
              this.phase = ATTACK_PHASE.IDLE;
              this.currentAttack = null;
              this.attackProgress = 0;
              this.scheduleNextAttack();
            }, attack.recoveryDuration);
            
          }, attack.executeDuration);
          
        }, attack.telegraphDuration);
      }
      
      damageBoss(amount) {
        this.isHit = true;
        setTimeout(() => this.isHit = false, BOSS_CONFIG.DAMAGE_FLASH_DURATION);
        
        this.bossHP = Math.max(0, this.bossHP - amount);
        
        if (this.bossHP <= 0) {
          this.clearAllTimers();
          this.phase = ATTACK_PHASE.IDLE;
          this.showMessage('VICTORY!');
        }
      }
      
      showMessage(text) {
        // Create temporary message element
        const msg = document.createElement('div');
        msg.style.cssText = `
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          font-size: 48px;
          font-family: 'Courier New', monospace;
          color: #00ff00;
          text-shadow: 0 0 30px #00ff00;
          z-index: 100;
        `;
        msg.textContent = text;
        this.container.appendChild(msg);
        setTimeout(() => msg.remove(), 2000);
      }
      
      onClick(e) {
        const rect = this.container.getBoundingClientRect();
        this.mouse.x = ((e.clientX - rect.left) / rect.width) * 2 - 1;
        this.mouse.y = -((e.clientY - rect.top) / rect.height) * 2 + 1;
        
        this.raycaster.setFromCamera(this.mouse, this.camera);
        const intersects = this.raycaster.intersectObject(this.weakPointMesh);
        
        if (intersects.length > 0 && this.phase === ATTACK_PHASE.RECOVERY) {
          this.damageBoss(50);
        }
      }
      
      onKeyDown(e) {
        // Number keys 1-9 to trigger attacks
        const num = parseInt(e.key);
        if (num >= 1 && num <= 9) {
          const attacks = this.getAttacksForLevel();
          if (attacks[num - 1]) {
            this.forceAttack(attacks[num - 1]);
          }
        }
        
        // R to reset
        if (e.key === 'r' || e.key === 'R') {
          this.resetBoss();
        }
      }
      
      updateBossVisuals(delta) {
        const time = performance.now() * 0.001;
        
        // Idle hover
        this.bossGroup.position.y = Math.sin(time * 2) * 0.3;
        
        // Shake during execution
        if (this.phase === ATTACK_PHASE.EXECUTING) {
          this.bossGroup.position.x = (Math.random() - 0.5) * 0.3;
          this.bossGroup.position.y += (Math.random() - 0.5) * 0.3;
        } else {
          this.bossGroup.position.x = 0;
        }
        
        // Color based on state
        if (this.isHit) {
          this.bodyMaterial.color.setHex(0xffffff);
          this.bodyMaterial.emissive.setHex(0xffffff);
        } else if (this.phase === ATTACK_PHASE.TELEGRAPH) {
          this.bodyMaterial.color.setHex(0xff8844);
          this.bodyMaterial.emissive.setHex(0x442200);
        } else if (this.phase === ATTACK_PHASE.EXECUTING) {
          this.bodyMaterial.color.setHex(0xff0000);
          this.bodyMaterial.emissive.setHex(0x880000);
        } else {
          const healthPercent = this.bossHP / this.maxHP;
          if (healthPercent < 0.25) {
            this.bodyMaterial.color.setHex(0xff4444);
          } else if (healthPercent < 0.5) {
            this.bodyMaterial.color.setHex(0xffaa44);
          } else {
            this.bodyMaterial.color.setHex(0x8844ff);
          }
          this.bodyMaterial.emissive.setHex(0x221144);
        }
        
        // Eye color
        if (this.phase === ATTACK_PHASE.IDLE) {
          this.eyeMaterial.color.setHex(0x00ff00);
          this.eyeLight.color.setHex(0x00ff00);
        } else {
          this.eyeMaterial.color.setHex(0xff0000);
          this.eyeLight.color.setHex(0xff0000);
        }
        
        // Core animation
        if (this.phase === ATTACK_PHASE.EXECUTING) {
          this.coreMaterial.color.setHex(0xff0000);
        } else {
          this.coreMaterial.color.setHex(0xff44ff);
        }
      }
      
      updateDangerZone(delta) {
        const time = performance.now() * 0.001;
        
        if (this.phase === ATTACK_PHASE.TELEGRAPH || this.phase === ATTACK_PHASE.EXECUTING) {
          this.dangerZoneGroup.visible = true;
          
          // Pulsing
          if (this.phase === ATTACK_PHASE.TELEGRAPH) {
            const pulse = (Math.sin(time * BOSS_CONFIG.DANGER_ZONE_PULSE_SPEED) + 1) / 2;
            this.dangerZoneMaterial.opacity = 0.4 * pulse;
          } else {
            this.dangerZoneMaterial.opacity = 0.6;
          }
        } else {
          this.dangerZoneGroup.visible = false;
        }
      }
      
      updateWeakPoint(delta) {
        const time = performance.now() * 0.001;
        
        if (this.phase === ATTACK_PHASE.RECOVERY) {
          this.weakPointMaterial.color.setHex(0xff0000);
          this.weakPointMaterial.emissive.setHex(0xff4400);
          this.weakPointMaterial.emissiveIntensity = 0.8;
          this.weakPointLight.intensity = 2;
          this.weakPointMesh.rotation.y += 0.02;
          this.weakPointMesh.rotation.x = Math.sin(time * 2) * 0.2;
        } else {
          this.weakPointMaterial.color.setHex(0x880000);
          this.weakPointMaterial.emissive.setHex(0x220000);
          this.weakPointMaterial.emissiveIntensity = 0.2;
          this.weakPointLight.intensity = 0;
        }
      }
      
      updateIndicator(delta) {
        if (this.phase === ATTACK_PHASE.TELEGRAPH) {
          this.indicatorGroup.visible = true;
          const scale = 0.5 + this.attackProgress * 1.5;
          this.indicatorMesh.scale.setScalar(scale);
          this.indicatorLight.intensity = 5 * this.attackProgress;
        } else {
          this.indicatorGroup.visible = false;
        }
      }
      
      updateHUD() {
        const healthPercent = (this.bossHP / this.maxHP) * 100;
        
        document.getElementById('hp-bar-inner').style.width = `${healthPercent}%`;
        document.getElementById('hp-current').textContent = `${Math.ceil(this.bossHP)} / ${this.maxHP}`;
        document.getElementById('hp-percent').textContent = `${healthPercent.toFixed(1)}%`;
        
        // HP bar color
        const hpBar = document.getElementById('hp-bar-inner');
        if (healthPercent < 10) {
          hpBar.style.background = 'linear-gradient(90deg, #ff0000, #ff4444)';
          document.getElementById('hp-bar-outer').style.borderColor = '#ff0000';
        } else if (healthPercent < 25) {
          hpBar.style.background = 'linear-gradient(90deg, #ff4400, #ff8844)';
          document.getElementById('hp-bar-outer').style.borderColor = '#ff8800';
        } else {
          hpBar.style.background = 'linear-gradient(90deg, #ff2222, #ff6666)';
          document.getElementById('hp-bar-outer').style.borderColor = '#ff4444';
        }
        
        // Attack status
        const attackStatus = document.getElementById('attack-status');
        const attackPhase = document.getElementById('attack-phase');
        const attackName = document.getElementById('attack-name');
        const evasionHint = document.getElementById('evasion-hint');
        
        if (this.currentAttack && this.phase !== ATTACK_PHASE.IDLE) {
          attackStatus.classList.add('visible');
          attackStatus.className = `visible ${this.phase}`;
          attackName.textContent = this.currentAttack.name;
          
          if (this.phase === ATTACK_PHASE.TELEGRAPH) {
            attackPhase.textContent = '‚ö† WARNING';
            attackPhase.style.color = '#ffaa00';
            evasionHint.textContent = `EVADE: ${this.currentAttack.evasionDirection.toUpperCase()}`;
            evasionHint.style.display = 'block';
          } else if (this.phase === ATTACK_PHASE.EXECUTING) {
            attackPhase.textContent = 'üí• ATTACKING';
            attackPhase.style.color = '#ff4444';
            evasionHint.style.display = 'none';
          } else if (this.phase === ATTACK_PHASE.RECOVERY) {
            attackPhase.textContent = 'üéØ VULNERABLE';
            attackPhase.style.color = '#00ff88';
            evasionHint.textContent = 'STRIKE THE WEAK POINT!';
            evasionHint.style.display = 'block';
          }
        } else {
          attackStatus.classList.remove('visible');
        }
        
        // Evasion prompt
        const evasionPrompt = document.getElementById('evasion-prompt');
        const evasionDirection = document.getElementById('evasion-direction');
        const timingIndicator = document.getElementById('timing-indicator');
        const timingZone = document.getElementById('timing-zone');
        const dodgeText = document.getElementById('dodge-text');
        
        if (this.phase === ATTACK_PHASE.TELEGRAPH && this.currentAttack) {
          evasionPrompt.classList.add('visible');
          
          // Direction icon
          const dirIcons = {
            'up': '‚¨Ü',
            'down': '‚¨á',
            'horizontal': '‚¨Ö ‚û°',
            'vertical': '‚¨Ü ‚¨á',
            'barrel_roll': 'üîÑ',
            'retreat': '‚¨Ö‚¨Ö',
            'weave': '‚Üî',
            'random': '‚ùì',
            'complex': '‚ö°',
          };
          evasionDirection.textContent = dirIcons[this.currentAttack.evasionDirection] || '‚ö°';
          
          // Timing bar
          const windowStart = BOSS_CONFIG.EVASION_WINDOW_START;
          const windowEnd = BOSS_CONFIG.EVASION_WINDOW_END;
          timingZone.style.left = `${windowStart * 100}%`;
          timingZone.style.width = `${(windowEnd - windowStart) * 100}%`;
          timingIndicator.style.left = `${this.attackProgress * 100}%`;
          
          const isInWindow = this.attackProgress >= windowStart && this.attackProgress <= windowEnd;
          if (isInWindow) {
            evasionDirection.classList.add('optimal');
            timingIndicator.style.background = '#00ff00';
            timingIndicator.style.boxShadow = '0 0 10px #00ff00';
            dodgeText.classList.add('visible');
          } else {
            evasionDirection.classList.remove('optimal');
            timingIndicator.style.background = '#ffffff';
            timingIndicator.style.boxShadow = 'none';
            dodgeText.classList.remove('visible');
          }
        } else {
          evasionPrompt.classList.remove('visible');
        }
      }
      
      update(delta) {
        // Update attack progress
        if (this.phase !== ATTACK_PHASE.IDLE && this.phaseDuration > 0) {
          const elapsed = performance.now() - this.attackStartTime;
          this.attackProgress = Math.min(1, elapsed / this.phaseDuration);
        }
        
        this.updateBossVisuals(delta);
        this.updateDangerZone(delta);
        this.updateWeakPoint(delta);
        this.updateIndicator(delta);
        this.updateHUD();
      }
      
      animate() {
        requestAnimationFrame(() => this.animate());
        
        const now = performance.now();
        const delta = Math.min((now - this.lastTime) / 1000, 0.1);
        this.lastTime = now;
        
        this.update(delta);
        this.renderer.render(this.scene, this.camera);
      }
      
      onResize() {
        const width = this.container.clientWidth;
        const height = this.container.clientHeight;
        
        this.camera.aspect = width / height;
        this.camera.updateProjectionMatrix();
        this.renderer.setSize(width, height);
      }
    }

    // ========================================================================
    // INITIALIZE
    // ========================================================================
    window.addEventListener('DOMContentLoaded', () => {
      const container = document.getElementById('game-canvas');
      const game = new BossFightGame(container);
      
      container.addEventListener('click', () => {
        container.focus();
      });
    });
  </script>
</body>
</html>
